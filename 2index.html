<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¯¶è²é§•åˆ°ï¼æ€§åˆ¥æ­æ›‰æ´¾å°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Varela+Round&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* --- å…¨åŸŸè¨­å®š (ç¶­æŒä¸è®Š) --- */
        :root {
            --bg-color: #FDFBF7; --text-color: #5D4037; --btn-color: #FFD54F; --btn-text: #4E342E;
            --card-1-bg: #FFFDE7; --card-2-bg: #E0F2F1; --card-3-bg: #FFF3E0;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: 'Varela Round', 'Noto Sans TC', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; min-height: 100vh; }
        #app { width: 100%; max-width: 480px; background: #fff; min-height: 100vh; position: relative; overflow-x: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        
        /* èƒŒæ™¯è£é£¾ */
        .bg-decor { position: absolute; z-index: 0; pointer-events: none; opacity: 0.6; }
        .cloud { top: 20px; left: -20px; font-size: 3rem; opacity: 0.5; animation: float 6s ease-in-out infinite; }
        .star { top: 80px; right: 10px; font-size: 1.5rem; color: #FFD54F; animation: twinkle 3s infinite; }
        .feet { bottom: 20px; left: 20px; font-size: 2rem; opacity: 0.2; transform: rotate(15deg); }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes twinkle { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* é é¢åˆ‡æ› */
        .page { display: none; flex-direction: column; align-items: center; padding: 30px 20px; text-align: center; animation: fadeIn 0.6s ease; z-index: 1; flex: 1; }
        .page.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* åœ–ç‰‡å®¹å™¨ */
        .img-box { width: 100%; border-radius: 20px; overflow: hidden; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background-color: #eee; }
        .img-box img { width: 100%; height: auto; display: block; }

        /* æ–‡å­—æ¨£å¼ */
        h1 { font-size: 1.6rem; color: #8D6E63; margin-bottom: 10px; line-height: 1.4; }
        p { font-size: 1rem; line-height: 1.6; color: #6D4C41; margin-bottom: 20px; text-align: justify; }
        .highlight { color: #FF7043; font-weight: bold; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { background-color: var(--btn-color); color: var(--btn-text); border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; width: 90%; box-shadow: 0 4px 0 #FBC02D; transition: all 0.1s; margin-top: auto; margin-bottom: 20px; }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn:disabled { background-color: #ccc; box-shadow: none; cursor: not-allowed; color: #666; }

        /* é¸é …èˆ‡è£é£¾ */
        .guess-options { display: flex; justify-content: center; gap: 20px; margin: 20px 0; width: 100%; }
        .guess-btn { width: 140px; height: 140px; border-radius: 50%; border: 4px solid #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .guess-btn.boy { background: #E3F2FD; color: #1565C0; }
        .guess-btn.girl { background: #FCE4EC; color: #C2185B; }
        .guess-btn.selected { transform: scale(1.1); border-color: #FFD54F; box-shadow: 0 0 15px #FFD54F; }
        .icon-lg { font-size: 2.5rem; margin-bottom: 5px; }
        .mystery-box { margin: 10px auto; font-size: 4rem; color: #AB47BC; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* å¡ç‰‡èˆ‡æ¨£å¼åˆ‡æ› */
        .style-switcher { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .style-tab { padding: 8px 12px; font-size: 0.85rem; border: 1px solid #ccc; border-radius: 20px; background: #fff; cursor: pointer; }
        .style-tab.active { background: #8D6E63; color: #fff; border-color: #8D6E63; }
        
        /* ç‚ºäº†æˆªåœ–å®Œæ•´ï¼Œç§»é™¤ transitionï¼Œä¸¦ç¢ºä¿èƒŒæ™¯è‰²æ­£ç¢º */
        .card-container { width: 100%; padding: 20px; margin-bottom: 20px; position: relative; background: #fff; }
        
        .style-1 { background-color: var(--card-1-bg); border-radius: 15px; border: 2px solid #FFF59D; color: #616161; }
        .style-1 .decor { position: absolute; font-size: 1.2rem; color: #FFE0B2; }
        .style-2 { background-color: var(--card-2-bg); border-radius: 20px 0 20px 0; border: 1px solid #B2DFDB; color: #37474F; box-shadow: 0 0 15px rgba(178, 223, 219, 0.6); }
        .style-3 { background-color: #fff; border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; border: 4px dashed #FFCC80; color: #3E2723; }

        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        /* è§£æ±º iOS è¼¸å…¥æ¡†æ”¾å¤§å•é¡Œ */
        .form-input { width: 100%; padding: 10px; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; background: rgba(255,255,255,0.7); font-family: inherit; font-size: 16px; }
        textarea.form-input { resize: none; height: 80px; }
    </style>
</head>
<body>

<div id="app">
    <div class="bg-decor cloud">â˜ï¸</div>
    <div class="bg-decor star">âœ¨</div>
    <div class="bg-decor feet">ğŸ‘£</div>

    <div id="page-1" class="page active">
        <h1>å¯¶è²é§•åˆ°ï¼<br>æ€§åˆ¥æ­æ›‰æ´¾å°ï¼</h1>
        <div class="img-box"><img src="https://raw.githubusercontent.com/xiaomai050204-jpg/-party/main/cover.jpg" alt="Cover" onerror="this.src='https://placehold.co/600x400/FFF3E0/8D6E63?text=Baby+Party'"></div>
        <p>è¦ªæ„›çš„æœ‹å‹å€‘ï¼Œæ„Ÿè¬æ‚¨ä¾†åƒåŠ æˆ‘å€‘çš„å¯¶å¯¶æ€§åˆ¥æ´¾å°ï¼åœ¨æ­æ›‰å¯¶å¯¶çš„æ€§åˆ¥ä¹‹å‰ï¼Œå…ˆä¾†ç©å€‹å°éŠæˆ²ï¼Œæ†‘æ‚¨çš„ç›´è¦ºï¼ŒçŒœçŒœçœ‹æ˜¯å°ç‹å­é‚„æ˜¯å°å…¬ä¸»å‘¢ï¼Ÿ</p>
        <button class="btn" onclick="nextPage(2)">é–‹å§‹çŒœçŒœæ¨‚</button>
    </div>

    <div id="page-2" class="page">
        <h1>Hi è¦ªæ„›çš„æœ‹å‹~~</h1>
        <p>è·Ÿå¤§å®¶å…¬å¸ƒä¸€å€‹å¥½æ¶ˆæ¯~<span class="highlight">æˆ‘æ‡·å­•äº†ï¼</span><br>ç›®å‰å·²ç¶“ç¬¬ 5 å€‹æœˆï¼Œå¯¶å¯¶çš„å¿ƒè·³ã€ç™¼å±•å„æ–¹é¢éƒ½æ­£å¸¸ï¼Œæ„Ÿè¬ä¸Šå¸~</p>
        <div class="img-box"><img src="https://raw.githubusercontent.com/xiaomai050204-jpg/-party/main/cover2.jpg" alt="Ultrasound" onerror="this.src='https://placehold.co/600x400/ECEFF1/607D8B?text=Ultrasound+Photo'"></div>
        <button class="btn" onclick="nextPage(3)">é€²å…¥æ€§åˆ¥é æ¸¬ âœ</button>
    </div>

    <div id="page-3" class="page">
        <h1>ç›´è¦ºå¤§è€ƒé©—ï¼</h1>
        <div class="mystery-box">ğŸ‘¶â“</div>
        <div class="guess-options">
            <div class="guess-btn boy" onclick="selectGender('Boy', this)"><div class="icon-lg">ğŸ€ğŸ“š</div><div>ç”·å­© (Boy)</div></div>
            <div class="guess-btn girl" onclick="selectGender('Girl', this)"><div class="icon-lg">ğŸ’ğŸ‘—</div><div>å¥³å­© (Girl)</div></div>
        </div>
        <button class="btn" onclick="submitGuess()">é€å‡ºä½ çš„ç­”æ¡ˆï¼</button>
    </div>

    <div id="page-4" class="page">
        <h1>æ„Ÿè¬æ‚¨çš„åƒèˆ‡ï¼</h1>
        <div class="img-box"><img src="https://raw.githubusercontent.com/xiaomai050204-jpg/-party/main/coming_soon.jpg" alt="Coming Soon" onerror="this.src='https://placehold.co/600x400/FFF8E1/FF8F00?text=Coming+Soon'"></div>
        <p>çµæœå³å°‡æ­æ›‰ï¼Œè«‹æº–å‚™å¥½ä¸€åŒè¦‹è­‰é€™å¹¸ç¦çš„æ™‚åˆ»ï¼</p>
        <button class="btn" onclick="nextPage(5)">æ­æ›‰çµæœ ğŸ‰</button>
    </div>

    <div id="page-5" class="page">
        <h1 style="color:#1565C0">ç­”æ¡ˆæ­æ›‰ï¼<br>æ˜¯ä½å°ç‹å­ï¼</h1>
        <div class="img-box"><img src="https://raw.githubusercontent.com/xiaomai050204-jpg/-party/main/result.jpg" alt="Result Boy" onerror="this.src='https://placehold.co/600x400/E3F2FD/1565C0?text=It\'s+a+Boy!'"></div>
        <div style="background: rgba(255,255,255,0.8); padding: 15px; border-radius: 10px; text-align: left;">
            <p><strong>æ­å–œï¼æˆ‘å€‘å³å°‡è¿ä¾†ä¸€ä½å¯æ„›çš„å°ç”·å­©ï¼</strong></p>
            <p>æ„Ÿè¬å¤§å®¶çš„ç¥ç¦ï¼å¯¶å¯¶å°åå«<span class="highlight">å°éº¥</span>ã€‚</p>
            <p style="text-align: center; color: #F57F17; font-weight: bold; margin-top: 10px;">æœŸå¾…èˆ‡å¤§å®¶æ˜å¹´4æœˆè¦‹é¢~~</p>
        </div>
        <button class="btn" onclick="nextPage(6)">ç•™ä¸‹æ‚¨çš„ç¥ç¦ âœ‰ï¸</button>
    </div>

    <div id="page-6" class="page">
        <h1>ç•™ä¸‹æ‚¨çš„ç¥ç¦</h1>
        <p style="font-size: 0.9rem; margin-bottom: 10px;">è«‹é¸æ“‡å¡ç‰‡ä¸¦å¡«å¯«ï¼Œå‚³é€çµ¦æˆ‘å€‘ï¼š</p>

        <div class="style-switcher">
            <div class="style-tab active" onclick="setStyle(1, this)">é™½å…‰æº«æš–</div>
            <div class="style-tab" onclick="setStyle(2, this)">å¤¢å¹»æ˜Ÿç©º</div>
            <div class="style-tab" onclick="setStyle(3, this)">æ´»æ½‘ç©æœ¨</div>
        </div>

        <div id="card-area" class="card-container style-1">
            <div id="decor-container"></div> 
            <h2 style="margin-top:0; text-align: center;">çµ¦å°å¯¶è²çš„ç¥ç¦</h2>
            <div class="form-group">
                <label>æ‚¨çš„åå­—æ˜¯ï¼Ÿ</label>
                <input type="text" id="name" class="form-input" placeholder="è«‹è¼¸å…¥å§“å">
            </div>
            <div class="form-group">
                <label id="msg-label">çµ¦å°å¯¶è²çš„ç¥ç¦ï¼</label>
                <textarea id="message" class="form-input" placeholder="å¯«ä¸‹å°å¯¶å¯¶çš„ç¥ç¦..."></textarea>
            </div>
            <div style="text-align: right; font-size: 0.7rem; opacity: 0.6; margin-top: 10px;">From: å¯¶å¯¶æ€§åˆ¥æ­æ›‰æ´¾å°</div>
        </div>

        <button id="send-btn" class="btn" style="background-color: #06C755; color: #fff;" onclick="captureAndShare()">
            ğŸ“¸ ä¸‹è¼‰å¡ç‰‡ä¸¦å‚³Line
        </button>
        <p id="line-hint" style="font-size: 0.8rem; color: #E65100; margin-top: 5px; display: none; background: #FFF3E0; padding: 10px; border-radius: 8px;">
            <strong>æ­¥é©Ÿï¼š</strong><br>
            1. å¡ç‰‡åœ–ç‰‡å·²ä¸‹è¼‰åˆ°æ‰‹æ©Ÿç›¸ç°¿ã€‚<br>
            2. ç¶²é å°‡è·³è½‰è‡³ Lineã€‚<br>
            3. è«‹åœ¨ Line èŠå¤©å®¤é»é¸ã€Œç›¸ç°¿ã€é¸æ“‡å‰›å‰›çš„åœ–ç‰‡å‚³çµ¦æˆ‘å€‘ï¼
        </button>
    </div>

</div>

<script>
    // --- åŸºç¤åŠŸèƒ½è®Šæ•¸ ---
    let currentGuess = null;
    let currentStyle = 1;

    // --- é é¢åˆ‡æ› ---
    function nextPage(pageNum) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + pageNum).classList.add('active');
        document.getElementById('app').scrollTo(0,0);
        window.scrollTo(0,0);
    }

    // --- éŠæˆ²é‚è¼¯ ---
    function selectGender(gender, btn) {
        currentGuess = gender;
        document.querySelectorAll('.guess-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }
    function submitGuess() {
        if(!currentGuess) { alert("è«‹å…ˆé»é¸ä¸€å€‹ç›´è¦ºé¸é …å–”ï¼"); return; }
        nextPage(4);
    }

    // --- å¡ç‰‡æ¨£å¼åˆ‡æ› ---
    function setStyle(styleNum, tabElement) {
        currentStyle = styleNum;
        document.querySelectorAll('.style-tab').forEach(t => t.classList.remove('active'));
        tabElement.classList.add('active');

        const card = document.getElementById('card-area');
        const decor = document.getElementById('decor-container');
        const msgLabel = document.getElementById('msg-label');
        
        card.className = `card-container style-${styleNum}`;
        
        if(styleNum === 1) {
            msgLabel.innerText = "çµ¦å°å¯¶è²çš„ç¥ç¦ï¼";
            decor.innerHTML = `<span class="decor" style="top:5px; left:5px;">ğŸ§¸</span><span class="decor" style="top:5px; right:5px;">ğŸ´</span><span class="decor" style="bottom:5px; left:5px;">ğŸ¼</span><span class="decor" style="bottom:5px; right:5px;">ğŸ‘£</span>`;
        } else if(styleNum === 2) {
            msgLabel.innerText = "æƒ³å°å¯¶å¯¶èªªçš„æ‚„æ‚„è©±ï¼Ÿ";
            decor.innerHTML = `<span class="decor" style="top:30%; left:-5px; color:#FFD54F;">â­</span><span class="decor" style="top:50%; right:-5px; color:#B2DFDB;">â˜ï¸</span><span class="decor" style="top:10%; right:10px; font-size:1.5rem;">ğŸˆ</span>`;
        } else if(styleNum === 3) {
            msgLabel.innerText = "çµ¦å°å¯¶è²çš„ç¥ç¦ï¼";
            decor.innerHTML = `<span class="decor" style="top:-10px; left:10px; transform:rotate(-15deg); font-size:1.5rem;">ğŸš—</span><span class="decor" style="bottom:-10px; right:10px; transform:rotate(15deg); font-size:1.5rem;">ğŸ¦†</span><span class="decor" style="top:50%; left:-10px; color:#F48FB1;">â– </span><span class="decor" style="top:20%; right:-10px; color:#90CAF9;">â—</span>`;
        }
    }

    // --- â˜…â˜…â˜… æ ¸å¿ƒåŠŸèƒ½ï¼šæˆªåœ–ä¸¦è·³è½‰ Line â˜…â˜…â˜… ---
    function captureAndShare() {
        const name = document.getElementById('name').value;
        const msg = document.getElementById('message').value;
        const cardArea = document.getElementById('card-area');
        const btn = document.getElementById('send-btn');
        const hint = document.getElementById('line-hint');

        if (!name || !msg) {
            alert("è«‹è¨˜å¾—è¼¸å…¥åå­—å’Œç¥ç¦èªå–”ï¼");
            return;
        }

        // 1. UI ç‹€æ…‹æ›´æ–°
        btn.disabled = true;
        btn.innerHTML = "â³ æ­£åœ¨è£½ä½œå¡ç‰‡åœ–æª”...";
        hint.style.display = "block"; // é¡¯ç¤ºæ“ä½œæç¤º

        // 2. åŸ·è¡Œæˆªåœ–
        html2canvas(cardArea, {
            scale: 2, // æé«˜è§£æåº¦ (2å€) è®“åœ–ç‰‡æ›´æ¸…æ™°
            useCORS: true, // å…è¨±è·¨åŸŸåœ–ç‰‡
            backgroundColor: null // èƒŒæ™¯é€æ˜æˆ–è‡ªå‹•
        }).then(canvas => {
            
            // 3. è§¸ç™¼åœ–ç‰‡ä¸‹è¼‰
            const link = document.createElement('a');
            link.download = `å°å¯¶è²ç¥ç¦å¡_${name}.png`;
            link.href = canvas.toDataURL("image/png");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // 4. æº–å‚™ Line æ–‡å­—èˆ‡é€£çµ
            btn.innerHTML = "âœ… åœ–ç‰‡ä¸‹è¼‰å®Œæˆï¼æ­£åœ¨é–‹å•Ÿ Line...";
            
            const lineMsg = `æˆ‘æ˜¯ ${name}ï¼Œ\né€™æ˜¯çµ¦å°éº¥å¯¶å¯¶çš„ç¥ç¦å¡ç‰‡ï¼(åœ–ç‰‡è«‹æ‰‹å‹•å¾ç›¸ç°¿ä¸Šå‚³)`;
            // ä½¿ç”¨ Line URL Scheme
            const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(lineMsg)}`;

            // 5. å»¶é² 1.5 ç§’å¾Œè·³è½‰ (çµ¦æ‰‹æ©Ÿä¸€é»æ™‚é–“è™•ç†ä¸‹è¼‰)
            setTimeout(() => {
                window.location.href = lineUrl;
                
                // é‡ç½®æŒ‰éˆ•
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = "ğŸ“¸ ä¸‹è¼‰å¡ç‰‡ä¸¦å‚³Line";
                }, 1000);
            }, 1500);

        }).catch(err => {
            console.error(err);
            alert("æˆªåœ–å¤±æ•—ï¼Œè«‹æ‚¨æ‰‹å‹•æ‰‹æ©Ÿæˆªåœ–å‚³çµ¦æˆ‘å€‘å–”ï¼");
            btn.disabled = false;
            btn.innerHTML = "ğŸ“¸ ä¸‹è¼‰å¡ç‰‡ä¸¦å‚³Line";
        });
    }

    // åˆå§‹åŒ–
    setStyle(1, document.querySelector('.style-tab'));
</script>
</body>
</html>
